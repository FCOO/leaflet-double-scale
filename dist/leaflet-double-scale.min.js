!function(a,b,c,d){"use strict";a.Control.DoubleScale=a.Control.extend({options:{type:"both",position:"bottomleft",updateWhenIdle:!1,minUnitWidth:40,maxUnitsWidth:200,fill:"hollow",backgroundColor:"white",opacity:.4,showSubunits:!1,doubleLine:!1,labelPlacement:"auto",decimalSeparator:function(){var a=1.1;return a=a.toLocaleString(),a.indexOf(".")>-1?".":a.indexOf(",")>-1?",":"."}()},onAdd:function(b){var c,d,e,f="both"==this.options.type;if(this._map=b,f){this.options.type="nautical",this.options.labelPlacement="top",this.options.doubleLine=!1;var g=a.extend({},this.options);g.type="metric",g.labelPlacement="bottom",g.dontAddBackground=!0,g.clickable=!1,c=a.control.doubleScale(g),d=c.onAdd(b)}if(this._possibleUnitsNum=[3,5,2,4],this._possibleUnitsNumLen=this._possibleUnitsNum.length,this._possibleDivisions=[1,.5,.25,.2],this._possibleDivisionsLen=this._possibleDivisions.length,this._possibleDivisionsSub={1:{num:2,division:.5},.5:{num:5,division:.1},.25:{num:5,division:.05},.2:{num:2,division:.1}},this._scaleInner=this._buildScale(),this._scale=this._addScale(this._scaleInner),this.outerElement=this._scale,this._setStyle(this.options),b.on(this.options.updateWhenIdle?"moveend":"move",this._update,this),b.whenReady(this._update,this),f?(e=a.DomUtil.create("div","leaflet-control-graphicscale-outer"),e.appendChild(this._scale),e.appendChild(d),this.outerElement=e):e=this._scale,!this.options.dontAddBackground){var h=a.DomUtil.create("div","leaflet-control-graphicscale-background");a.DomUtil.setOpacity(h,this.options.opacity),h.style.backgroundColor=this.options.backgroundColor,e.insertBefore(h,e.lastChild)}return e},onRemove:function(a){a.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},onClick:function(b,c){a.DomUtil.addClass(this.outerElement,"leaflet-control-graphicscale-clickable"),a.DomEvent.disableClickPropagation(this.outerElement),a.DomEvent.addListener(this.outerElement,"click",b,c)},_addScale:function(b){var c=a.DomUtil.create("div");return c.className="leaflet-control-graphicscale",c.appendChild(b),c},_setStyle:function(a){var b=["leaflet-control-graphicscale-inner"];a.fill&&"nofill"!==a.fill&&(b.push("filled"),b.push("filled-"+a.fill)),a.showSubunits&&b.push("showsubunits"),a.doubleLine&&b.push("double"),b.push("labelPlacement-"+a.labelPlacement),this._scaleInner.className=b.join(" ")},_buildScale:function(){var b=c.createElement("div");b.className="leaflet-control-graphicscale-inner";var d=a.DomUtil.create("div","subunits",b),e=a.DomUtil.create("div","units",b);this._units=[],this._unitsLbls=[],this._subunits=[];for(var f=0;5>f;f++){var g=this._buildDivision(f%2===0);e.appendChild(g),this._units.push(g);var h=this._buildDivisionLbl();g.appendChild(h),this._unitsLbls.push(h);var i=this._buildDivision(f%2===1);d.appendChild(i),this._subunits.unshift(i)}return this._zeroLbl=a.DomUtil.create("div","label zeroLabel"),this._zeroLbl.innerHTML="0",this._units[0].appendChild(this._zeroLbl),this._subunitsLbl=a.DomUtil.create("div","label subunitsLabel"),this._subunitsLbl.innerHTML="?",this._subunits[4].appendChild(this._subunitsLbl),b},_buildDivision:function(b){var c=a.DomUtil.create("div","division"),d=a.DomUtil.create("div","line");c.appendChild(d);var e=a.DomUtil.create("div","line2");return c.appendChild(e),b&&d.appendChild(a.DomUtil.create("div","fill")),b||e.appendChild(a.DomUtil.create("div","fill")),c},_buildDivisionLbl:function(){var b=a.DomUtil.create("div","label divisionLabel");return b},_update:function(){var a=this._map.getBounds(),b=a.getCenter().lat,c=6378137*Math.PI*Math.cos(b*Math.PI/180),d=c*(a.getNorthEast().lng-a.getSouthWest().lng)/180,e=this._map.getSize();"nautical"==this.options.type&&(d/=1.852),e.x>0&&this._updateScale(d,this.options)},_updateScale:function(a,b){var c=this._getBestScale(a,b.minUnitWidth,b.maxUnitsWidth);this._render(c)},_getBestScale:function(a,b,c){var d=this._getPossibleUnits(a,b,this._map.getSize().x),e=this._getPossibleScales(d,c);e.sort(function(a,b){return b.score-a.score});var f=e[0];return f.subunits=this._getSubunits(f),f},_getSubunits:function(a){var b=this._possibleDivisionsSub[a.unit.unitDivision],c={};c.subunitDivision=b.division,c.subunitMeters=b.division*(a.unit.unitMeters/a.unit.unitDivision),c.subunitPx=b.division*(a.unit.unitPx/a.unit.unitDivision);var d={subunit:c,numSubunits:b.num,total:b.num*c.subunitMeters};return d},_getPossibleScales:function(a,b){for(var c,d=[],e=Number.POSITIVE_INFINITY,f=0;f<this._possibleUnitsNumLen;f++)for(var g=this._possibleUnitsNum[f],h=.5*(this._possibleUnitsNumLen-f),i=0;i<a.length;i++){var j=a[i],k=j.unitPx*g,l={unit:j,totalWidthPx:k,numUnits:g,score:0},m=1-(b-k)/b;m*=10;var n=j.unitScore+h+m;(.25===j.unitDivision&&3===g||.5===j.unitDivision&&3===g||.25===j.unitDivision&&5===g)&&(n-=2),l.score=n,b>k&&d.push(l),e>k&&(e=k,c=l)}return d.length||d.push(c),d},_getPossibleUnits:function(a,b,c){for(var d,e=(Math.floor(a)+"").length,f=[],g=e;g>0;g--){d=Math.pow(10,g);for(var h=0;h<this._possibleDivisionsLen;h++){var i=d*this._possibleDivisions[h],j=c*(i/a);if(b>j)return f;f.push({unitMeters:i,unitPx:j,unitDivision:this._possibleDivisions[h],unitScore:this._possibleDivisionsLen-h})}}return f},_render:function(a){this._renderPart(a.unit.unitPx,a.unit.unitMeters,a.numUnits,this._units,this._unitsLbls),this._renderPart(a.subunits.subunit.subunitPx,a.subunits.subunit.subunitMeters,a.subunits.numSubunits,this._subunits);var b=this._getDisplayUnit(a.subunits.total);this._subunitsLbl.innerHTML=""+b.amount+b.unit},_renderPart:function(a,b,c,d,e){for(var f=this._getDisplayUnit(b),g="."==this.options.decimalSeparator?",":".",h=0;h<this._units.length;h++){var i=d[h];if(c>h?(i.style.width=a+"px",i.className="division"):(i.style.width=0,i.className="division hidden"),e){var j=e[h],k=["label","divisionLabel"];if(c>h){var l=(h+1)*f.amount;l=Math.round(100*l)/100;var m=l.toString().split(".");m[0]=m[0].replace(/\B(?=(\d{3})+(?!\d))/g,g),l=m.join(this.options.decimalSeparator),h===c-1?(l+=f.unit,k.push("labelLast")):k.push("labelSub"),j.innerHTML=l}j.className=k.join(" ")}}},_getDisplayUnit:function(a){if("metric"==this.options.type){var b=1e3>a?"m":"km";return{unit:b,amount:"km"===b?a/1e3:a}}return{unit:"nm",amount:a/1e3}}}),a.Map.mergeOptions({doubleScaleControl:!1}),a.Map.addInitHook(function(){this.options.doubleScaleControl&&(this.doubleScaleControl=new a.Control.DoubleScale,this.addControl(this.doubleScaleControl))}),a.control.doubleScale=function(b){return new a.Control.DoubleScale(b)}}(L,this,document);